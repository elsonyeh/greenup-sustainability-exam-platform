# è³‡æ–™åº«è¨­ç½®èªªæ˜

## æ–‡ä»¶èªªæ˜

### 1. schema.sql
å®Œæ•´çš„è³‡æ–™åº«æ¶æ§‹æ–‡ä»¶ï¼Œé©ç”¨æ–¼å…¨æ–°è³‡æ–™åº«çš„åˆå§‹åŒ–ã€‚

### 2. storage_migration.sql
é ­åƒä¸Šå‚³åŠŸèƒ½çš„é·ç§»æ–‡ä»¶ï¼Œé©ç”¨æ–¼ç¾æœ‰è³‡æ–™åº«æ·»åŠ StorageåŠŸèƒ½ã€‚

## ä½¿ç”¨æ–¹å¼

### å°æ–¼å…¨æ–°è³‡æ–™åº«
åŸ·è¡Œ `schema.sql` ä¾†å‰µå»ºå®Œæ•´çš„è³‡æ–™åº«çµæ§‹ï¼š

```sql
-- åœ¨ Supabase SQL Editor ä¸­åŸ·è¡Œ
\i schema.sql
```

### å°æ–¼ç¾æœ‰è³‡æ–™åº«
å¦‚æœæ‚¨çš„è³‡æ–™åº«å·²ç¶“å­˜åœ¨ï¼ˆä¾‹å¦‚å·²ç¶“æœ‰ profiles è¡¨ï¼‰ï¼Œè«‹ä½¿ç”¨é·ç§»æ–‡ä»¶ï¼š

```sql
-- åœ¨ Supabase SQL Editor ä¸­åŸ·è¡Œ
\i storage_migration.sql
```

## é ­åƒä¸Šå‚³åŠŸèƒ½è¨­ç½®

åŸ·è¡Œ `storage_migration.sql` å¾Œï¼Œå°‡æœƒï¼š

1. âœ… å‰µå»º `avatars` storage bucket
2. âœ… è¨­ç½®é©ç•¶çš„å­˜å–ç­–ç•¥ï¼š
   - ç”¨æˆ¶åªèƒ½ä¸Šå‚³è‡ªå·±çš„é ­åƒ
   - æ‰€æœ‰äººå¯ä»¥æŸ¥çœ‹é ­åƒ
   - ç”¨æˆ¶å¯ä»¥æ›´æ–°/åˆªé™¤è‡ªå·±çš„é ­åƒ

## é©—è­‰è¨­ç½®

åŸ·è¡Œé·ç§»å¾Œï¼Œæ‚¨å¯ä»¥åœ¨ Supabase Dashboard ä¸­ç¢ºèªï¼š

1. **Storage > Buckets** - ç¢ºèª `avatars` bucket å·²å‰µå»º
2. **Storage > Policies** - ç¢ºèªé ­åƒç›¸é—œç­–ç•¥å·²è¨­ç½®
3. **Database > Tables** - ç¢ºèª `profiles` è¡¨åŒ…å« `avatar_url` æ¬„ä½

## éŒ¯èª¤è™•ç†

### "relation already exists" éŒ¯èª¤
å¦‚æœé‡åˆ°æ­¤éŒ¯èª¤ï¼Œè¡¨ç¤ºæ‚¨æ­£åœ¨å˜—è©¦é‡æ–°å‰µå»ºå·²å­˜åœ¨çš„è¡¨ã€‚è«‹ä½¿ç”¨ï¼š
- å°æ–¼ç¾æœ‰è³‡æ–™åº«ï¼šåŸ·è¡Œ `storage_migration.sql`
- å°æ–¼å…¨æ–°ç’°å¢ƒï¼šå…ˆæ¸…ç©ºè³‡æ–™åº«å†åŸ·è¡Œ `schema.sql`

### Storage æ¬Šé™éŒ¯èª¤
ç¢ºä¿æ‚¨æœ‰è¶³å¤ çš„æ¬Šé™æ“ä½œ Storage bucketsã€‚åœ¨ Supabase ä¸­éœ€è¦ï¼š
- Project Owner æˆ– Admin æ¬Šé™
- å•Ÿç”¨ Storage åŠŸèƒ½

## æ³¨æ„äº‹é …

1. ğŸ”’ Storage ç­–ç•¥ä½¿ç”¨ Row Level Security (RLS)
2. ğŸ“ é ­åƒæª”æ¡ˆå°‡å­˜å„²åœ¨è·¯å¾‘ `avatars/{user_id}-{timestamp}.{ext}`
3. ğŸŒ Bucket è¨­ç‚º publicï¼Œä½†ç”±ç­–ç•¥æ§åˆ¶å­˜å–æ¬Šé™
4. ğŸ“ æ‡‰ç”¨ç¨‹å¼ç«¯é™åˆ¶æª”æ¡ˆå¤§å°ç‚º 5MB